library(ggplot2)
library(asaur)
library(survival)
library(ggfortify)

data = prostateSurvival
data$status[data$status == 2] <- 0
print(data)
cox <- coxph(Surv(survTime , status) ~ grade + stage + ageGroup , data = data )
#summary(cox)

cox_fit <- survfit(cox)
#autoplot(cox_fit)

#proportional hazard assomption
print("proportional hazard assomption")
prop <-cox.zph(cox,transform = 'km',global = TRUE)
print(prop)
#print('il y a donc les variables grade et ageGroup qui violent l'hypothèse de proportionnalité des risques (p > 0,05)  ')
#plot(prop)
print('Laissons le model faire lui même de facon autimatique le cox regression ')
#prop.auto <- step(cox)
#summary(prop.auto)
#stratification du model
cox <- coxph(Surv(survTime , status) ~ strata(grade) + stage + strata(ageGroup) , data = data )
prop <-cox.zph(cox,transform = 'km',global = TRUE)
print(prop)
plot(prop)
cox_fit <- survfit(cox)
autoplot(cox_fit)